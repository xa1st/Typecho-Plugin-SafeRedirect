# Typecho SafeRedirect Plugin

一个用于 Typecho 博客系统的安全跳转插件，自动拦截外部链接并显示跳转提示页面，提升网站安全性和用户体验。

## 🌟 功能特性

- **自动拦截外部链接**：自动检测并拦截所有外部链接点击
- **安全跳转提示**：显示友好的跳转提示页面，告知用户即将离开当前网站
- **可自定义配置**：支持自定义跳转延时、按钮颜色、提示文案等
- **URL 白名单**：支持设置排除的 URL 列表，指定域名不会被拦截
- **主题兼容**：支持主题自定义跳转页面模板
- **Base64 编码**：使用 URL 安全的 Base64 编码保护跳转地址
- **响应式设计**：跳转页面适配移动端和桌面端

## 📋 系统要求

- Typecho 1.0.0 或更高版本
- PHP 7.0 或更高版本

## 🚀 安装方法

### 方法一：直接下载

1. 下载插件文件
2. 将整个 `SafeRedirect` 文件夹上传到 `/usr/plugins/` 目录
3. 登录 Typecho 后台，进入「控制台」->「插件管理」
4. 找到「SafeRedirect」插件，点击「启用」

### 方法二：Git 克隆

```bash
cd /path/to/typecho/usr/plugins/
git clone https://github.com/xa1st/Typecho-Plugin-SafeRedirect.git SafeRedirect
```

## ⚙️ 配置说明

启用插件后，在插件设置页面可以配置以下选项：

| 配置项 | 默认值 | 说明 |
|--------|--------|------|
| 跳转延时 | 5 秒 | 自动跳转的等待时间，设置为 0 则不延时 |
| 按钮颜色 | #007bff | 跳转按钮的背景颜色，可配合主题风格 |
| 提示页标题 | 外链跳转 | 跳转页面的网页标题 |
| 提示标题 | 外链跳转提示 | 跳转页面显示的主标题 |
| 提示副标题 | 您正在离开本站，前往以下网址： | 跳转提示的副标题文字 |
| 跳转警告语 | 请注意，我们无法保证... | 安全警告提示文字 |
| 排除的URL | 空 | 不需要跳转提示的域名列表，一行一个 |

## 🎨 自定义跳转页面(可选)

插件支持主题自定义跳转页面模板：

1. 将 `go.php.demo` 复制到你的主题目录
2. 重命名为 `go.php`
3. 根据主题风格自定义样式和布局

### 可用变量

在自定义模板中，你可以使用以下变量：

- `$this->_target`：目标跳转地址
- `$plugin['title']`：配置的页面标题
- `$plugin['tip']`：配置的提示标题
- `$plugin['tip1']`：配置的提示副标题
- `$plugin['tipContent']`：配置的警告文字
- `$plugin['delay']`：配置的跳转延时
- `$plugin['buttonColor']`：配置的按钮颜色

## 📁 文件结构

```
SafeRedirect/
├── Plugin.php          # 插件主文件
├── Action.php          # 跳转处理逻辑
├── go.php.demo         # 跳转页面模板示例
└── README.md           # 说明文档
```

## 🔧 工作原理

1. **前端拦截**：插件在页面底部注入 JavaScript 代码，监听所有链接点击事件
2. **外链检测**：判断链接是否为外部域名，排除白名单中的域名
3. **URL 编码**：将外部链接使用 URL 安全的 Base64 编码
4. **跳转处理**：重定向到插件路由 `/go/{encoded_url}`
5. **页面显示**：显示跳转提示页面或使用主题自定义模板
6. **安全跳转**：用户确认后跳转到目标地址

## 🛡️ 安全特性

- **URL 验证**：严格验证跳转地址格式，防止恶意跳转
- **Base64 编码**：使用 URL 安全编码，防止 URL 参数注入
- **协议检查**：仅允许 HTTP/HTTPS 协议跳转
- **跳转提示**：明确告知用户即将离开当前网站
- **rel 属性**：跳转链接添加 `nofollow noopener noreferrer` 属性

## 🔧 高级配置

### 排除域名设置

在插件配置的「排除的URL」中，每行添加一个域名（不包含协议）：

```
github.com
stackoverflow.com
blog.example.com
```

### 自定义样式

如果不使用主题模板，可以通过修改插件配置来调整默认页面样式：

- 修改按钮颜色来适配主题色调
- 自定义提示文案来符合网站风格
- 调整跳转延时来平衡用户体验

## 🐛 故障排除

### 插件无法启用
- 检查 Typecho 版本是否为 1.0.0 或更高
- 确认插件文件完整且位于正确目录

### 外链没有被拦截
- 检查浏览器控制台是否有 JavaScript 错误
- 确认链接不在排除列表中
- 检查链接是否为相对路径

### 跳转页面样式异常
- 检查主题是否有 CSS 冲突
- 尝试调整按钮颜色配置
- 考虑使用自定义主题模板

## 📝 更新日志

### v1.0.0
- 初始发布
- 基础外链拦截功能
- 可配置跳转页面
- 支持主题自定义模板
- URL 白名单功能

## 🤝 贡献

欢迎提交 Issue 和 Pull Request 来帮助改进这个插件！

1. Fork 本仓库
2. 创建特性分支 (`git checkout -b feature/AmazingFeature`)
3. 提交更改 (`git commit -m 'Add some AmazingFeature'`)
4. 推送到分支 (`git push origin feature/AmazingFeature`)
5. 开启 Pull Request

## 📜 许可证

本项目采用 MIT 许可证 - 查看 [LICENSE](LICENSE) 文件了解详情。

## 👨‍💻 作者

- **猫东东** - *初始开发* - [xa1st](https://github.com/xa1st)

## 🙏 致谢

感谢所有为 Typecho 生态系统做出贡献的开发者们！

---

如果这个插件对你有帮助，请给个 ⭐ Star 支持一下！